<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Real Estate Admin Dashboard - Manage properties, agents, appointments and inquiries">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <title>Admin Dashboard - Monolith Realty</title>
</head>

<body class="bg-gray-50 font-sans text-gray-900">
    <div class="flex h-screen overflow-hidden">
        <!-- Mobile Overlay -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden" onclick="closeSidebar()"></div>

        <!-- Sidebar -->
        <aside id="sidebar"
            class="w-64 bg-white border-r border-gray-200 flex flex-col justify-between z-40 fixed md:relative h-full -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
            <div>

                <div class="h-16 flex items-center justify-between px-6 border-b border-gray-100">
                    <div class="flex items-center">
                        <div class="bg-blue-600 text-white p-1 rounded-md mr-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-gray-800">RealEstate Admin</h1>
                            <p class="text-xs text-gray-500">Management Panel</p>
                        </div>
                    </div>
                    <!-- Mobile Close Button -->
                    <button
                        class="md:hidden p-2 rounded-lg hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors"
                        onclick="closeSidebar()">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Admin Profile eka snippet type yanne -->
                <div class="p-6 border-b border-gray-100">
                    <div class="flex items-center space-x-3">
                        <div
                            class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold">
                            A
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-gray-700" id="sidebarAdminName">Admin</p>
                            <p class="text-xs text-gray-500 truncate w-32" id="sidebarAdminEmail">admin@example.com</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation set eka -->
                <nav class="p-4 space-y-1 overflow-y-auto max-h-[calc(100vh-250px)]">
                    <a href="#" id="navDashboard" onclick="showDashboardView(); return false;"
                        class="nav-item flex items-center px-4 py-3 bg-blue-50 text-blue-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                            </path>
                        </svg>
                        Dashboard
                        <span id="dashboardIndicator" class="ml-auto w-2 h-2 bg-blue-600 rounded-full"></span>
                    </a>
                    <a href="#" id="navProperties" onclick="showPropertiesView(); return false;"
                        class="nav-item flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                            </path>
                        </svg>
                        Properties
                        <span id="propertiesIndicator" class="ml-auto w-2 h-2 bg-blue-600 rounded-full hidden"></span>
                    </a>
                    <a href="#" id="navAgents" onclick="showAgentsView(); return false;"
                        class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z">
                            </path>
                        </svg>
                        Agents
                        <span id="agentsIndicator" class="ml-auto w-2 h-2 bg-blue-600 rounded-full hidden"></span>
                    </a>
                    <a href="#" id="navPendingListings" onclick="showPendingListingsView(); return false;"
                        class="nav-item flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-orange-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Pending Listings
                        <span id="pendingListingsCount"
                            class="ml-auto px-2 py-0.5 bg-orange-100 text-orange-600 text-xs font-semibold rounded-full">0</span>
                    </a>
                    <a href="#" id="navSellerApplications" onclick="showSellerApplicationsView(); return false;"
                        class="nav-item flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-purple-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
                            </path>
                        </svg>
                        Seller Applications
                        <span id="sellerApplicationsCount"
                            class="ml-auto px-2 py-0.5 bg-purple-100 text-purple-600 text-xs font-semibold rounded-full hidden">0</span>
                    </a>
                    <a href="#" id="navAccounts" onclick="showAccountsView(); return false;"
                        class="nav-item flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-teal-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 4v1m6 11h2m-6 0h-2v4h-4v-4H8m16 0V4a2 2 0 00-2-2h-2v4h-4V2H8v4H6a2 2 0 00-2 2v10a2 2 0 002 2h2v-4h4v4h2">
                            </path>
                        </svg>
                        Accounts
                    </a>
                    <a href="#"
                        class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        Appointments
                    </a>
                    <a href="/admin-inquiries.html"
                        class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 hover:text-blue-600 rounded-lg transition-colors">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                            </path>
                        </svg>
                        Inquiries
                    </a>
                </nav>
            </div>

            <div class="p-4 border-t border-gray-100">
                <button id="logoutBtn"
                    class="flex items-center w-full px-4 py-3 text-gray-600 hover:bg-red-50 hover:text-red-600 rounded-lg transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                        </path>
                    </svg>
                    Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-gray-50 p-4 lg:p-8">
            <!-- Topbar -->
            <header
                class="flex items-center justify-between mb-8 bg-white p-4 rounded-xl shadow-sm md:bg-transparent md:shadow-none md:p-0">
                <div class="flex items-center md:hidden">
                    <button id="mobileMenuBtn"
                        class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors"
                        onclick="toggleSidebar()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <span class="ml-3 text-lg font-bold text-gray-800">Admin Dashboard</span>
                </div>

                <div class="hidden md:flex items-center text-gray-500 text-sm">
                    <button class="mr-4 hover:text-blue-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h7"></path>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold text-gray-800">Admin Dashboard</h2>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="flex items-center text-green-500 text-sm font-medium">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                        System Online
                    </div>
                    <button class="relative text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                            </path>
                        </svg>
                        <span
                            class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                    </button>
                    <div class="flex items-center space-x-2 pl-4 border-l border-gray-200">
                        <div
                            class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm">
                            A</div>
                        <div class="hidden md:block">
                            <p class="text-sm font-semibold text-gray-700" id="topbarAdminName">Admin</p>
                            <p class="text-xs text-gray-500">Administrator</p>
                        </div>
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </div>
                </div>
            </header>

            <!--  Dashboard eka  -->
            <div id="dashboardView">
                <!-- I'm adding welcoming Header for all admins -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Welcome back, <span
                                id="welcomeAdminName" class="text-blue-600">Admin</span>!</h1>
                        <p class="text-gray-500 mt-1">Here's what's happening with your Real Estate platform today.</p>
                    </div>
                    <button onclick="openAddPropertyModal()"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4">
                            </path>
                        </svg>
                        Quick Actions
                    </button>
                </div>

                <!-- Stats Cards Row 1 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- Total Users Card -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Total Users</p>
                                <h3 id="statTotalUsers" class="text-3xl font-bold text-gray-800 mt-2">0</h3>
                                <a href="#"
                                    class="text-blue-600 text-sm font-medium mt-3 inline-flex items-center hover:text-blue-700">
                                    View all →
                                </a>
                            </div>
                            <div class="p-3 bg-purple-100 rounded-xl">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Total Properties Card  -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Total Properties</p>
                                <h3 id="statTotalProperties" class="text-3xl font-bold text-gray-800 mt-2">0</h3>
                                <a href="#" onclick="showPropertiesView(); return false;"
                                    class="text-blue-600 text-sm font-medium mt-3 inline-flex items-center hover:text-blue-700">
                                    View all →
                                </a>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-xl">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Active Listings Card -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Active Listings</p>
                                <h3 id="statActiveListings" class="text-3xl font-bold text-gray-800 mt-2">0</h3>
                                <a href="#"
                                    class="text-blue-600 text-sm font-medium mt-3 inline-flex items-center hover:text-blue-700">
                                    View all →
                                </a>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-xl">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Properties Card -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Pending Properties</p>
                                <h3 id="statPendingProperties" class="text-3xl font-bold text-gray-800 mt-2">0</h3>
                                <a href="#"
                                    class="text-blue-600 text-sm font-medium mt-3 inline-flex items-center hover:text-blue-700">
                                    View all →
                                </a>
                            </div>
                            <div class="p-3 bg-yellow-100 rounded-xl">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards Row 2 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                    <!-- Sold Properties Card -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Sold Properties</p>
                                <h3 id="statSoldProperties" class="text-3xl font-bold text-gray-800 mt-2">0</h3>
                                <a href="#"
                                    class="text-blue-600 text-sm font-medium mt-3 inline-flex items-center hover:text-blue-700">
                                    View all →
                                </a>
                            </div>
                            <div class="p-3 bg-emerald-100 rounded-xl">
                                <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div id="pendingListingsView" class="hidden">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h1 class="text-3xl font-bold text-gray-800">Pending Approvals</h1>
                                <p class="text-gray-500 mt-2">Review and approve new property submissions.</p>
                            </div>
                            <button onclick="loadPendingListings()"
                                class="p-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-gray-600">
                                <span class="material-symbols-outlined text-[20px]">refresh</span>
                            </button>
                        </div>

                        <div id="pending-listings-container" class="grid grid-cols-1 gap-6">
                            <div class="text-center py-12 text-gray-500">Loading pending listings...</div>
                        </div>
                    </div>

                    <!-- Rented Properties Card -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Rented Properties</p>
                                <h3 id="statRentedProperties" class="text-3xl font-bold text-gray-800 mt-2">0</h3>
                                <a href="#"
                                    class="text-blue-600 text-sm font-medium mt-3 inline-flex items-center hover:text-blue-700">
                                    View all →
                                </a>
                            </div>
                            <div class="p-3 bg-cyan-100 rounded-xl">
                                <svg class="w-6 h-6 text-cyan-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Success Rate Card -->
                    <div
                        class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm font-medium">Listing Success Rate</p>
                                <h3 id="statSuccessRate" class="text-3xl font-bold text-gray-800 mt-2">100%</h3>
                                <p class="text-gray-400 text-xs mt-1"><span id="statSuccessDetail">0 of 0</span>
                                    properties</p>
                            </div>
                            <div class="p-3 bg-indigo-100 rounded-xl">
                                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm mb-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="openAddPropertyModal()"
                            class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-blue-50 hover:border-blue-200 transition-colors group">
                            <div class="p-3 bg-blue-100 rounded-xl mr-4 group-hover:bg-blue-200 transition-colors">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                            </div>
                            <div class="text-left">
                                <p class="font-semibold text-gray-800">Add New Property</p>
                                <p class="text-sm text-gray-500">Create a new listing</p>
                            </div>
                        </button>

                        <button onclick="showPropertiesView()"
                            class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-blue-50 hover:border-blue-200 transition-colors group">
                            <div class="p-3 bg-blue-100 rounded-xl mr-4 group-hover:bg-blue-200 transition-colors">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4">
                                    </path>
                                </svg>
                            </div>
                            <div class="text-left">
                                <p class="font-semibold text-gray-800">Manage Properties</p>
                                <p class="text-sm text-gray-500">View all listings</p>
                            </div>
                        </button>

                        <button
                            class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-purple-50 hover:border-purple-200 transition-colors group">
                            <div class="p-3 bg-purple-100 rounded-xl mr-4 group-hover:bg-purple-200 transition-colors">
                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z">
                                    </path>
                                </svg>
                            </div>
                            <div class="text-left">
                                <p class="font-semibold text-gray-800">Manage Users</p>
                                <p class="text-sm text-gray-500">View registered users</p>
                            </div>
                        </button>

                        <button
                            class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-yellow-50 hover:border-yellow-200 transition-colors group">
                            <div class="p-3 bg-yellow-100 rounded-xl mr-4 group-hover:bg-yellow-200 transition-colors">
                                <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </div>
                            <div class="text-left">
                                <p class="font-semibold text-gray-800">View Inquiries</p>
                                <p class="text-sm text-gray-500">Check new inquiries</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- System Status Section -->
                <div class="bg-white rounded-xl p-6 border border-gray-100 shadow-sm">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">System Status</h3>
                    <div class="flex flex-wrap gap-8">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-full mr-3">
                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">Database</p>
                                <p class="text-sm text-green-600">Connected</p>
                            </div>
                        </div>

                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-full mr-3">
                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">API Service</p>
                                <p class="text-sm text-green-600">Operational</p>
                            </div>
                        </div>

                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-full mr-3">
                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">File Storage</p>
                                <p class="text-sm text-green-600">Active</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== PROPERTIES VIEW ==================== -->
            <div id="propertiesView" class="hidden">
                <!-- Breadcrumb -->
                <div class="flex items-center text-sm text-gray-500 mb-6">
                    <a href="#" onclick="showDashboardView(); return false;"
                        class="hover:text-blue-600 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                            </path>
                        </svg>
                        Dashboard
                    </a>
                    <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    <span class="text-gray-800 font-medium">Properties</span>
                </div>

                <!-- Content Area -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div
                        class="p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                                    </path>
                                </svg>
                                Properties Management
                            </h2>
                            <p class="text-gray-500 text-sm mt-1">Total Properties (14) - Active Listings</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button
                                class="px-4 py-2 bg-yellow-50 text-yellow-700 border border-yellow-200 rounded-lg text-sm font-medium hover:bg-yellow-100 transition-colors flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Verify Pending (3)
                            </button>
                            <button onclick="openAddPropertyModal()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Property
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="p-6 bg-gray-50 border-b border-gray-100 grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="md:col-span-2 relative">
                            <span
                                class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </span>

                            <input type="text" placeholder="Search properties..."
                                class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">

                        </div>
                        <select
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option>All Types</option>
                            <option>House</option>
                            <option>Apartment</option>
                            <option>Land</option>
                            <option>Commercial</option>
                        </select>
                        <select
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option>All Statuses</option>
                            <option>For Sale</option>
                            <option>For Rent</option>
                        </select>
                        <select
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option>All Cities</option>
                            <option>Colombo</option>
                            <option>Kandy</option>
                        </select>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs text-gray-500 uppercase border-b border-gray-100 bg-gray-50/50">
                                    <th class="px-6 py-4 font-semibold">Title</th>
                                    <th class="px-6 py-4 font-semibold">Price</th>
                                    <th class="px-6 py-4 font-semibold">Type</th>
                                    <th class="px-6 py-4 font-semibold">Location</th>
                                    <th class="px-6 py-4 font-semibold">Agent</th>
                                    <th class="px-6 py-4 font-semibold">Status</th>
                                    <th class="px-6 py-4 font-semibold">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 text-sm" id="propertiesTableBody">
                                <!-- Loading state -->
                                <tr id="propertiesLoading">
                                    <td colspan="7" class="px-6 py-12 text-center">
                                        <div class="flex flex-col items-center justify-center">
                                            <div
                                                class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-3">
                                            </div>
                                            <span class="text-gray-500">Loading properties...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div
                        class="px-6 py-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-500">
                        <p>Showing 1 to 14 of 14 data</p>
                        <div class="flex space-x-2">
                            <button
                                class="px-3 py-1 border border-gray-200 rounded hover:bg-gray-50 disabled:opacity-50">Previous</button>
                            <button
                                class="px-3 py-1 border border-gray-200 rounded bg-blue-600 text-white hover:bg-blue-700">1</button>
                            <button class="px-3 py-1 border border-gray-200 rounded hover:bg-gray-50">Next</button>
                        </div>
                    </div>

                </div>
            </div> <!-- End of propertiesView -->

            <!-- ==================== AGENTS VIEW ==================== -->
            <div id="agentsView" class="hidden">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <!-- Header -->
                    <div
                        class="p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z">
                                    </path>
                                </svg>
                                Agents Management
                            </h2>
                            <p class="text-gray-500 text-sm mt-1" id="agentsSubtitle">Manage your real estate agents</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="openAddAgentModal()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                                Add Agent
                            </button>
                        </div>
                    </div>

                    <!-- Agents Grid -->
                    <div class="p-6">
                        <div id="agentsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Loading state -->
                            <div class="col-span-full flex justify-center py-12">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500 mb-3">
                                    </div>
                                    <span class="text-gray-500">Loading agents...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- End of agentsView -->

            <!-- ==================== SELLER APPLICATIONS VIEW ==================== -->
            <div id="sellerApplicationsView" class="hidden">
                <!-- Breadcrumb -->
                <div class="flex items-center text-sm text-gray-500 mb-6">
                    <a href="#" onclick="showDashboardView(); return false;"
                        class="hover:text-blue-600 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                            </path>
                        </svg>
                        Dashboard
                    </a>
                    <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    <span class="text-gray-800 font-medium">Seller Applications</span>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div
                        class="p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
                                    </path>
                                </svg>
                                Seller Applications
                            </h2>
                            <p class="text-gray-500 text-sm mt-1">Review account requests from potential sellers</p>
                        </div>
                        <button onclick="loadSellerApplications()"
                            class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                </path>
                            </svg>
                            Refresh
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs text-gray-500 uppercase border-b border-gray-100 bg-gray-50/50">
                                    <th class="px-6 py-4 font-semibold">Applicant</th>
                                    <th class="px-6 py-4 font-semibold">Contact</th>
                                    <th class="px-6 py-4 font-semibold">Location</th>
                                    <th class="px-6 py-4 font-semibold">NIC/Reg No</th>
                                    <th class="px-6 py-4 font-semibold">Date</th>
                                    <th class="px-6 py-4 font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 text-sm" id="sellerApplicationsTableBody">
                                <tr id="sellerApplicationsLoading">
                                    <td colspan="6" class="px-6 py-12 text-center">
                                        <div class="flex flex-col items-center justify-center">
                                            <div
                                                class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500 mb-3">
                                            </div>
                                            <span class="text-gray-500">Loading applications...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="emptySellerApplicationsState" class="hidden p-12 text-center">
                        <div class="mx-auto w-16 h-16 bg-purple-50 rounded-full flex items-center justify-center mb-4">
                            <svg class="w-8 h-8 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
                                </path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">No Pending Applications</h3>
                        <p class="text-gray-400">There are no new seller requests at this time.</p>
                    </div>
                </div>
            </div> <!-- End of sellerApplicationsView -->

            <!-- ==================== ACCOUNTS VIEW ==================== -->
            <div id="accountsView" class="hidden">
                <!-- Breadcrumb -->
                <div class="flex items-center text-sm text-gray-500 mb-6">
                    <a href="#" onclick="showDashboardView(); return false;"
                        class="hover:text-blue-600 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                            </path>
                        </svg>
                        Dashboard
                    </a>
                    <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    <span class="text-gray-800 font-medium">Pre-Generated Accounts</span>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <svg class="w-6 h-6 mr-2 text-teal-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v1m6 11h2m-6 0h-2v4h-4v-4H8m16 0V4a2 2 0 00-2-2h-2v4h-4V2H8v4H6a2 2 0 00-2 2v10a2 2 0 002 2h2v-4h4v4h2">
                                    </path>
                                </svg>
                                Seller Accounts
                            </h2>
                            <p class="text-gray-500 text-sm mt-1">Manage manual and pre-generated seller accounts</p>
                        </div>
                        <button onclick="openAddAccountModal()"
                            class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4"></path>
                            </svg>
                            Add Account
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs text-gray-500 uppercase border-b border-gray-100 bg-gray-50/50">
                                    <th class="px-6 py-4 font-semibold">Username / Email</th>
                                    <th class="px-6 py-4 font-semibold">Password</th>
                                    <th class="px-6 py-4 font-semibold text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 text-sm" id="accountsTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ==================== PENDING LISTINGS VIEW ==================== -->

            <div id="pendingListingsView" class="hidden">
                <!-- Breadcrumb -->
                <div class="flex items-center text-sm text-gray-500 mb-6">
                    <a href="#" onclick="showDashboardView(); return false;"
                        class="hover:text-blue-600 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                            </path>
                        </svg>
                        Dashboard
                    </a>
                    <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    <span class="text-gray-800 font-medium">Pending Listings</span>
                </div>

                <!-- Content Area -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div
                        class="p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                                <svg class="w-6 h-6 mr-2 text-orange-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Pending Listings Review
                            </h2>
                            <p class="text-gray-500 text-sm mt-1" id="pendingListingsSubtitle">Review and approve seller
                                submissions</p>
                        </div>
                        <button onclick="loadPendingListings()"
                            class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                </path>
                            </svg>
                            Refresh
                        </button>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-xs text-gray-500 uppercase border-b border-gray-100 bg-gray-50/50">
                                    <th class="px-6 py-4 font-semibold">Property</th>
                                    <th class="px-6 py-4 font-semibold">Price</th>
                                    <th class="px-6 py-4 font-semibold">Location</th>
                                    <th class="px-6 py-4 font-semibold">Seller</th>
                                    <th class="px-6 py-4 font-semibold">Submitted</th>
                                    <th class="px-6 py-4 font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 text-sm" id="pendingListingsTableBody">
                                <!-- Loading state -->
                                <tr id="pendingListingsLoading">
                                    <td colspan="6" class="px-6 py-12 text-center">
                                        <div class="flex flex-col items-center justify-center">
                                            <div
                                                class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-orange-500 mb-3">
                                            </div>
                                            <span class="text-gray-500">Loading pending listings...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State (hidden by default) -->
                    <div id="emptyPendingState" class="hidden p-12 text-center">
                        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">All Caught Up!</h3>
                        <p class="text-gray-400">No, pending listings to review at the moment.</p>
                    </div>
                </div>
            </div> <!-- End of pendingListingsView -->
        </main>
    </div>

    <!-- ==================== ADD PROPERTY MODAL ==================== -->
    <div id="addPropertyModal" class="fixed inset-0 z-50 hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAddPropertyModal()"></div>

        <!-- Modal Content -->
        <div
            class="absolute right-0 top-0 h-full w-full max-w-lg bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-800">Add New Property</h2>
                <button onclick="closeAddPropertyModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <form id="addPropertyForm" class="p-6 space-y-6">
                <!-- Title & Address Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                        <input type="text" name="title" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="e.g., Luxury Villa in Colombo">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Address *</label>
                        <input type="text" name="address" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="e.g., 123 Main Street, Colombo 7">
                    </div>
                </div>

                <!-- Price & Type Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Price (LKR) *</label>
                        <input type="number" name="price" required min="0" step="1000"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="e.g., 50000000">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Property Type *</label>
                        <select name="type" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select type</option>
                            <option value="SALE">For Sale</option>
                            <option value="RENT">For Rent</option>
                            <option value="SHORT_STAY_RENTAL">Short-stay Rental</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">House Type</label>
                        <select name="houseType"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select house type</option>
                            <option value="APARTMENT">Apartment</option>
                            <option value="MANUFACTURED">Manufactured</option>
                            <option value="HOUSE">House</option>
                            <option value="TOWNHOME">Townhome</option>
                            <option value="LAND">Land</option>
                            <option value="MULTI_FAMILY">Multi-Family</option>
                        </select>
                    </div>
                </div>

                <!-- Status Row -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                    <select name="status" required
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                        <option value="AVAILABLE">Available</option>
                        <option value="PENDING">Pending</option>
                        <option value="SOLD">Sold</option>
                        <option value="RENTED">Rented</option>
                    </select>
                </div>

                <!-- Assigned Agent -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Assign Agent</label>
                    <select name="assignedAgentId" id="assignedAgentId"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                        <option value="">Select agent (optional)</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea name="description" rows="4" maxlength="1000"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"
                        placeholder="Enter property description (max 1000 characters)"></textarea>
                    <p class="text-xs text-gray-400 mt-1"><span id="descCharCount">0</span>/1000 characters</p>
                </div>

                <!-- Property Details Row -->
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bedrooms</label>
                        <input type="number" name="bedrooms" min="0" max="20"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bathrooms</label>
                        <input type="number" name="bathrooms" min="0" max="10"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Area (Sq.Ft)</label>
                        <input type="number" name="areaSqFt" min="0" step="0.01"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="0">
                    </div>
                </div>

                <!-- Image URL -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Main Image URL</label>
                    <input type="url" name="imageUrl" id="imageUrlInput"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                        placeholder="https://example.com/image.jpg" oninput="previewPropertyImage(this.value)">
                    <div id="imagePreviewContainer" class="mt-3 hidden">
                        <img id="imagePreview" src="" alt="Property Preview"
                            class="w-full h-48 object-cover rounded-lg border border-gray-200">
                    </div>
                </div>

                <!-- Additional Images -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Additional Images (Comma separated
                        URLs)</label>
                    <textarea name="additionalImages" rows="2"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"
                        placeholder="https://example.com/img1.jpg, https://example.com/img2.jpg"></textarea>
                </div>

                <!-- Facilities -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Facilities</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mb-2">
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer hover:bg-blue-50">
                            <input type="checkbox" name="facilities[]" value="WiFi"
                                class="rounded text-blue-600 focus:ring-blue-500">
                            <span>WiFi</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer hover:bg-blue-50">
                            <input type="checkbox" name="facilities[]" value="Parking"
                                class="rounded text-blue-600 focus:ring-blue-500">
                            <span>Parking</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer hover:bg-blue-50">
                            <input type="checkbox" name="facilities[]" value="Air Conditioning"
                                class="rounded text-blue-600 focus:ring-blue-500">
                            <span>Air Conditioning</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer hover:bg-blue-50">
                            <input type="checkbox" name="facilities[]" value="Pool"
                                class="rounded text-blue-600 focus:ring-blue-500">
                            <span>Pool</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer hover:bg-blue-50">
                            <input type="checkbox" name="facilities[]" value="Gym"
                                class="rounded text-blue-600 focus:ring-blue-500">
                            <span>Gym</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer hover:bg-blue-50">
                            <input type="checkbox" name="facilities[]" value="Kitchen"
                                class="rounded text-blue-600 focus:ring-blue-500">
                            <span>Kitchen</span>
                        </label>
                    </div>
                </div>

                <!-- House Rules -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">House Rules</label>
                    <textarea name="houseRules" rows="3"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"
                        placeholder="- No smoking inside&#10;- No pets allowed&#10;- Quiet hours after 10 PM"></textarea>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100">
                    <button type="button" onclick="closeAddPropertyModal()"
                        class="px-6 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                        Cancel
                    </button>
                    <button type="submit" id="submitPropertyBtn"
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4">
                            </path>
                        </svg>
                        Create Property
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Toast Notification -->
    <div id="successToast"
        class="fixed bottom-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span id="toastMessage">Property created successfully!</span>
    </div>

    <!-- ==================== EDIT PROPERTY MODAL ==================== -->
    <div id="editPropertyModal" class="fixed inset-0 z-50 hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeEditPropertyModal()"></div>

        <!-- Modal Content -->
        <div
            class="absolute right-0 top-0 h-full w-full max-w-lg bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-800">Edit Property</h2>
                <button onclick="closeEditPropertyModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <form id="editPropertyForm" class="p-6 space-y-6">
                <input type="hidden" name="id" id="editPropertyId">

                <!-- Title & Address Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                        <input type="text" name="title" id="editTitle" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Address *</label>
                        <input type="text" name="address" id="editAddress" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>

                <!-- Price & Type Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Price (LKR) *</label>
                        <input type="number" name="price" id="editPrice" required min="0" step="1000"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type *</label>
                        <select name="type" id="editType" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="SALE">For Sale</option>
                            <option value="RENT">For Rent</option>
                            <option value="SHORT_STAY_RENTAL">Short-stay Rental</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">House Type</label>
                        <select name="houseType" id="editHouseType"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select house type</option>
                            <option value="APARTMENT">Apartment</option>
                            <option value="MANUFACTURED">Manufactured</option>
                            <option value="HOUSE">House</option>
                            <option value="TOWNHOME">Townhome</option>
                            <option value="LAND">Land</option>
                            <option value="MULTI_FAMILY">Multi-Family</option>
                        </select>
                    </div>
                </div>

                <!-- Status Row -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                    <select name="status" id="editStatus" required
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                        <option value="AVAILABLE">Available</option>
                        <option value="PENDING">Pending</option>
                        <option value="SOLD">Sold</option>
                        <option value="RENTED">Rented</option>
                    </select>
                </div>

                <!-- Assigned Agent -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Assigned Agent</label>
                    <select name="assignedAgentId" id="editAssignedAgentId"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                        <option value="">No agent assigned</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea name="description" id="editDescription" rows="4" maxlength="1000"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>

                <!-- Property Details Row -->
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bedrooms</label>
                        <input type="number" name="bedrooms" id="editBedrooms" min="0" max="20"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bathrooms</label>
                        <input type="number" name="bathrooms" id="editBathrooms" min="0" max="10"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Area (Sq.Ft)</label>
                        <input type="number" name="areaSqFt" id="editAreaSqFt" min="0" step="0.01"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>

                <!-- Image URL -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Main Image</label>
                    <input type="url" id="editImageUrl" name="imageUrl"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 bg-gray-50"
                        oninput="previewEditPropertyImage(this.value)">
                    <div id="editImagePreviewContainer" class="mt-3 hidden">
                        <img id="editImagePreview" src=""
                            class="w-full h-48 object-cover rounded-lg border border-gray-200">
                    </div>
                </div>

                <!-- NEW: Additional Images Edit -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Additional Images (Comma
                        separated)</label>
                    <textarea id="editAdditionalImages" name="additionalImages" rows="2"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 bg-gray-50 resize-none"></textarea>
                </div>

                <!-- NEW: Facilities Edit -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Facilities</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mb-2" id="editFacilitiesContainer">
                        <!-- Cloned from add form or manually recreated -->
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer">
                            <input type="checkbox" name="editFacilities[]" value="WiFi" class="rounded text-blue-600">
                            <span>WiFi</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer">
                            <input type="checkbox" name="editFacilities[]" value="Parking"
                                class="rounded text-blue-600"> <span>Parking</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer">
                            <input type="checkbox" name="editFacilities[]" value="Air Conditioning"
                                class="rounded text-blue-600"> <span>Air Conditioning</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer">
                            <input type="checkbox" name="editFacilities[]" value="Pool" class="rounded text-blue-600">
                            <span>Pool</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer">
                            <input type="checkbox" name="editFacilities[]" value="Gym" class="rounded text-blue-600">
                            <span>Gym</span>
                        </label>
                        <label
                            class="flex items-center space-x-2 text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-100 cursor-pointer">
                            <input type="checkbox" name="editFacilities[]" value="Kitchen"
                                class="rounded text-blue-600"> <span>Kitchen</span>
                        </label>
                    </div>
                </div>

                <!-- NEW: House Rules Edit -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">House Rules</label>
                    <textarea id="editHouseRules" name="houseRules" rows="3"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 bg-gray-50 resize-none"></textarea>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-between gap-3 pt-4 border-t border-gray-100">
                    <button type="button" onclick="deleteProperty()" id="deletePropertyBtn"
                        class="px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                        Delete
                    </button>
                    <div class="flex items-center gap-3">
                        <button type="button" onclick="closeEditPropertyModal()"
                            class="px-6 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                            Cancel
                        </button>
                        <button type="submit" id="updatePropertyBtn"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                            Save Changes
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== VIEW PROPERTY MODAL ==================== -->
    <div id="viewPropertyModal" class="fixed inset-0 z-50 hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeViewPropertyModal()"></div>

        <!-- Modal Content -->
        <div
            class="absolute right-0 top-0 h-full w-full max-w-2xl bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                        </path>
                    </svg>
                    Property Details
                </h2>
                <button onclick="closeViewPropertyModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6" id="viewPropertyModalContent">
                <!-- Loading State -->
                <div id="viewPropertyLoading" class="flex flex-col items-center justify-center py-12">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                    <span class="text-gray-500">Loading property details...</span>
                </div>

                <!-- Property Content (hidden by default, shown when loaded) -->
                <div id="viewPropertyData" class="hidden space-y-6">
                    <!-- Image Gallery -->
                    <div id="viewPropertyImages" class="space-y-3">
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Property Images</h3>
                        <div id="viewPropertyMainImage" class="rounded-xl overflow-hidden border border-gray-200">
                            <img id="viewPropertyMainImg" src="" alt="Main Property Image"
                                class="w-full h-64 object-cover cursor-pointer" onclick="openImageFullscreen(this.src)">
                        </div>
                        <div id="viewPropertyThumbnails" class="grid grid-cols-4 gap-2">
                            <!-- Thumbnails will be populated here -->
                        </div>
                    </div>

                    <!-- Basic Info -->
                    <div class="bg-gray-50 rounded-xl p-4 space-y-3">
                        <div class="flex items-start justify-between">
                            <div>
                                <h3 id="viewPropertyTitle" class="text-xl font-bold text-gray-800"></h3>
                                <p id="viewPropertyAddress" class="text-gray-600 flex items-center mt-1">
                                    <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                                        </path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span></span>
                                </p>
                            </div>
                            <div class="text-right">
                                <p id="viewPropertyPrice" class="text-2xl font-bold text-blue-600"></p>
                                <span id="viewPropertyType" class="px-3 py-1 text-xs font-semibold rounded-full"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Property Features -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white border border-gray-200 rounded-xl p-4 text-center">
                            <svg class="w-6 h-6 mx-auto text-blue-500 mb-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                                </path>
                            </svg>
                            <p id="viewPropertyBedrooms" class="text-xl font-bold text-gray-800">0</p>
                            <p class="text-xs text-gray-500">Bedrooms</p>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-xl p-4 text-center">
                            <svg class="w-6 h-6 mx-auto text-blue-500 mb-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"></path>
                            </svg>
                            <p id="viewPropertyBathrooms" class="text-xl font-bold text-gray-800">0</p>
                            <p class="text-xs text-gray-500">Bathrooms</p>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-xl p-4 text-center">
                            <svg class="w-6 h-6 mx-auto text-blue-500 mb-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4">
                                </path>
                            </svg>
                            <p id="viewPropertyArea" class="text-xl font-bold text-gray-800">0</p>
                            <p class="text-xs text-gray-500">Sq.Ft</p>
                        </div>
                    </div>

                    <!-- Description -->
                    <div id="viewPropertyDescSection">
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Description</h3>
                        <p id="viewPropertyDescription" class="text-gray-700 leading-relaxed"></p>
                    </div>

                    <!-- Facilities -->
                    <div id="viewPropertyFacilitiesSection">
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Amenities</h3>
                        <div id="viewPropertyFacilities" class="flex flex-wrap gap-2">
                            <!-- Facility badges will be populated here -->
                        </div>
                    </div>

                    <!-- House Rules -->
                    <div id="viewPropertyRulesSection" class="hidden">
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">House Rules</h3>
                        <p id="viewPropertyRules" class="text-gray-700 whitespace-pre-line"></p>
                    </div>

                    <!-- Owner Info -->
                    <div class="bg-orange-50 border border-orange-100 rounded-xl p-4">
                        <h3
                            class="text-sm font-semibold text-orange-600 uppercase tracking-wider mb-3 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Owner Information
                        </h3>
                        <div class="space-y-2">
                            <p class="flex items-center text-gray-700">
                                <span class="font-medium w-20">Name:</span>
                                <span id="viewPropertyOwnerName"></span>
                            </p>
                            <p class="flex items-center text-gray-700">
                                <span class="font-medium w-20">Phone:</span>
                                <a id="viewPropertyOwnerPhone" href="#" class="text-blue-600 hover:underline"></a>
                            </p>
                            <p class="flex items-center text-gray-700">
                                <span class="font-medium w-20">Email:</span>
                                <a id="viewPropertyOwnerEmail" href="#" class="text-blue-600 hover:underline"></a>
                            </p>
                        </div>
                    </div>

                    <!-- Drive Resource -->
                    <div id="viewPropertyDriveSection" class="hidden bg-blue-50 border border-blue-100 rounded-xl p-4">
                        <h3 class="text-sm font-semibold text-blue-600 uppercase tracking-wider mb-2">Drive Resource
                        </h3>
                        <a id="viewPropertyDriveLink" href="#" target="_blank" rel="noopener noreferrer"
                            class="inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                            Open Drive
                        </a>
                    </div>

                    <!-- Submission Info -->
                    <div class="text-center text-sm text-gray-500">
                        <span>Submitted on </span>
                        <span id="viewPropertyCreatedAt" class="font-medium"></span>
                    </div>
                </div>
            </div>

            <!-- Modal Footer - Actions -->
            <div class="sticky bottom-0 bg-white border-t border-gray-100 p-4 flex items-center justify-between">
                <button onclick="closeViewPropertyModal()"
                    class="px-6 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                    Close
                </button>
                <div class="flex items-center gap-3" id="viewPropertyActions">
                    <button id="viewPropertyApproveBtn" onclick="approveFromModal()"
                        class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        Approve
                    </button>
                    <button id="viewPropertyRejectBtn" onclick="rejectFromModal()"
                        class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        Reject
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Fullscreen Modal -->
    <div id="imageFullscreenModal" class="fixed inset-0 z-[60] hidden bg-black/90 flex items-center justify-center"
        onclick="closeImageFullscreen()">
        <button onclick="closeImageFullscreen()"
            class="absolute top-4 right-4 p-2 text-white hover:text-gray-300 transition-colors">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <img id="fullscreenImage" src="" alt="Fullscreen Image" class="max-w-full max-h-full object-contain">
    </div>

    <!-- ==================== ADD AGENT MODAL ==================== -->
    <div id="addAgentModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAddAgentModal()"></div>
        <div
            class="absolute right-0 top-0 h-full w-full max-w-lg bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-800">Add New Agent</h2>
                <button onclick="closeAddAgentModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <form id="addAgentForm" class="p-6 space-y-6">
                <!-- Name & Email -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                        <input type="text" name="name" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="John Smith">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                        <input type="email" name="email" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="john@example.com">
                    </div>
                </div>

                <!-- Phone & Title -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" name="phone"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="+94 77 123 4567">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Title *</label>
                        <input type="text" name="title" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="Senior Property Consultant">
                    </div>
                </div>

                <!-- Specialization & Location -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Specialization</label>
                        <select name="specialization"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select Specialization</option>
                            <option value="Luxury Properties">Luxury Properties</option>
                            <option value="Residential">Residential</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Land & Plots">Land & Plots</option>
                            <option value="Apartments">Apartments</option>
                            <option value="Industrial">Industrial</option>
                            <option value="Rental Properties">Rental Properties</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Location (District)</label>
                        <select name="location"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select District</option>
                            <option value="Colombo">Colombo</option>
                            <option value="Gampaha">Gampaha</option>
                            <option value="Kalutara">Kalutara</option>
                            <option value="Kandy">Kandy</option>
                            <option value="Matale">Matale</option>
                            <option value="Nuwara Eliya">Nuwara Eliya</option>
                            <option value="Galle">Galle</option>
                            <option value="Matara">Matara</option>
                            <option value="Hambantota">Hambantota</option>
                            <option value="Jaffna">Jaffna</option>
                            <option value="Kilinochchi">Kilinochchi</option>
                            <option value="Mannar">Mannar</option>
                            <option value="Vavuniya">Vavuniya</option>
                            <option value="Mullaitivu">Mullaitivu</option>
                            <option value="Batticaloa">Batticaloa</option>
                            <option value="Ampara">Ampara</option>
                            <option value="Trincomalee">Trincomalee</option>
                            <option value="Kurunegala">Kurunegala</option>
                            <option value="Puttalam">Puttalam</option>
                            <option value="Anuradhapura">Anuradhapura</option>
                            <option value="Polonnaruwa">Polonnaruwa</option>
                            <option value="Badulla">Badulla</option>
                            <option value="Monaragala">Monaragala</option>
                            <option value="Ratnapura">Ratnapura</option>
                            <option value="Kegalle">Kegalle</option>
                        </select>
                    </div>
                </div>

                <!-- Status -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select name="status"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="ACTIVE">Active</option>
                            <option value="INACTIVE">Inactive</option>
                        </select>
                    </div>
                </div>

                <!-- Degree & Qualifications -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Degree</label>
                        <input type="text" name="degree"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="MBA in Real Estate">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Qualifications</label>
                        <input type="text" name="qualifications"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="RERA Certified">
                    </div>
                </div>

                <!-- Experience, Properties Sold, Rating -->
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Experience (Years)</label>
                        <input type="number" name="experience" min="0" max="50"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="5">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Properties Sold</label>
                        <input type="number" name="propertiesSold" min="0"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rating (1-5)</label>
                        <input type="number" name="rating" min="1" max="5" step="0.1"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                            placeholder="5.0">
                    </div>
                </div>

                <!-- Bio -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                    <textarea name="bio" rows="3" maxlength="500"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"
                        placeholder="A brief biography of the agent..."></textarea>
                </div>

                <!-- Profile Image URL -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Profile Image URL</label>
                    <input type="url" name="profileImageUrl"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                        placeholder="https://example.com/image.jpg"
                        oninput="previewAgentImage(this.value, 'addAgentImagePreview', 'addAgentImagePreviewContainer')">
                    <div id="addAgentImagePreviewContainer" class="mt-3 hidden">
                        <img id="addAgentImagePreview" src="" alt="Agent Preview"
                            class="w-24 h-24 object-cover rounded-full border-4 border-gray-200 mx-auto">
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100">
                    <button type="button" onclick="closeAddAgentModal()"
                        class="px-6 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                        Cancel
                    </button>
                    <button type="submit" id="submitAgentBtn"
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4">
                            </path>
                        </svg>
                        Create Agent
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== EDIT AGENT MODAL ==================== -->
    <div id="editAgentModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeEditAgentModal()"></div>
        <div
            class="absolute right-0 top-0 h-full w-full max-w-lg bg-white shadow-2xl overflow-y-auto transform transition-transform duration-300">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-800">Edit Agent</h2>
                <button onclick="closeEditAgentModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <form id="editAgentForm" class="p-6 space-y-6">
                <input type="hidden" name="id" id="editAgentId">

                <!-- Name & Email -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                        <input type="text" name="name" id="editAgentName" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                        <input type="email" name="email" id="editAgentEmail" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>

                <!-- Phone & Title -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" name="phone" id="editAgentPhone"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Title *</label>
                        <input type="text" name="title" id="editAgentTitle" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>

                <!-- Specialization & Location -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Specialization</label>
                        <select name="specialization" id="editAgentSpecialization"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select Specialization</option>
                            <option value="Luxury Properties">Luxury Properties</option>
                            <option value="Residential">Residential</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Land & Plots">Land & Plots</option>
                            <option value="Apartments">Apartments</option>
                            <option value="Industrial">Industrial</option>
                            <option value="Rental Properties">Rental Properties</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Location (District)</label>
                        <select name="location" id="editAgentLocation"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="">Select District</option>
                            <option value="Colombo">Colombo</option>
                            <option value="Gampaha">Gampaha</option>
                            <option value="Kalutara">Kalutara</option>
                            <option value="Kandy">Kandy</option>
                            <option value="Matale">Matale</option>
                            <option value="Nuwara Eliya">Nuwara Eliya</option>
                            <option value="Galle">Galle</option>
                            <option value="Matara">Matara</option>
                            <option value="Hambantota">Hambantota</option>
                            <option value="Jaffna">Jaffna</option>
                            <option value="Kilinochchi">Kilinochchi</option>
                            <option value="Mannar">Mannar</option>
                            <option value="Vavuniya">Vavuniya</option>
                            <option value="Mullaitivu">Mullaitivu</option>
                            <option value="Batticaloa">Batticaloa</option>
                            <option value="Ampara">Ampara</option>
                            <option value="Trincomalee">Trincomalee</option>
                            <option value="Kurunegala">Kurunegala</option>
                            <option value="Puttalam">Puttalam</option>
                            <option value="Anuradhapura">Anuradhapura</option>
                            <option value="Polonnaruwa">Polonnaruwa</option>
                            <option value="Badulla">Badulla</option>
                            <option value="Monaragala">Monaragala</option>
                            <option value="Ratnapura">Ratnapura</option>
                            <option value="Kegalle">Kegalle</option>
                        </select>
                    </div>
                </div>

                <!-- Status -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select name="status" id="editAgentStatus"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none bg-white">
                            <option value="ACTIVE">Active</option>
                            <option value="INACTIVE">Inactive</option>
                        </select>
                    </div>
                </div>

                <!-- Degree & Qualifications -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Degree</label>
                        <input type="text" name="degree" id="editAgentDegree"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Qualifications</label>
                        <input type="text" name="qualifications" id="editAgentQualifications"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>

                <!-- Experience, Properties Sold, Rating -->
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Experience</label>
                        <input type="number" name="experience" id="editAgentExperience" min="0" max="50"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Properties Sold</label>
                        <input type="number" name="propertiesSold" id="editAgentPropertiesSold" min="0"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rating</label>
                        <input type="number" name="rating" id="editAgentRating" min="1" max="5" step="0.1"
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all">
                    </div>
                </div>

                <!-- Bio -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                    <textarea name="bio" id="editAgentBio" rows="3" maxlength="500"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all resize-none"></textarea>
                </div>

                <!-- Profile Image URL -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Profile Image URL</label>
                    <input type="url" name="profileImageUrl" id="editAgentProfileImageUrl"
                        class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                        oninput="previewAgentImage(this.value, 'editAgentImagePreview', 'editAgentImagePreviewContainer')">
                    <div id="editAgentImagePreviewContainer" class="mt-3 hidden">
                        <img id="editAgentImagePreview" src="" alt="Agent Preview"
                            class="w-24 h-24 object-cover rounded-full border-4 border-gray-200 mx-auto">
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-between gap-3 pt-4 border-t border-gray-100">
                    <button type="button" onclick="deleteAgent()" id="deleteAgentBtn"
                        class="px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                        Delete
                    </button>
                    <div class="flex items-center gap-3">
                        <button type="button" onclick="closeEditAgentModal()"
                            class="px-6 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                            Cancel
                        </button>
                        <button type="submit" id="updateAgentBtn"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                            Save Changes
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="addAccountModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAddAccountModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all">
                <div class="p-6 border-b border-gray-100 flex items-center justify-between">
                    <h2 class="text-xl font-bold text-gray-800">Add New Account</h2>
                    <button onclick="closeAddAccountModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <form id="addAccountForm" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Username (Email)</label>
                        <input type="email" name="username" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="text" name="password" required
                            class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 outline-none transition-all">
                    </div>
                    <div class="flex justify-end gap-3 pt-4">
                        <button type="button" onclick="closeAddAccountModal()"
                            class="px-4 py-2 border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                            Cancel
                        </button>
                        <button type="submit"
                            class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            Create Account
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module" src="/src/admin.js"></script>
    <script>
        // API Base URL
        const API_BASE = 'http://localhost:8080';

        // Helper function to get auth headers for admin API calls
        function getAuthHeaders() {
            const token = localStorage.getItem('token');
            return {
                'Content-Type': 'application/json',
                'Authorization': token ? `Bearer ${token}` : ''
            };
        }

        // ==================== VIEW NAVIGATION ====================
        function showDashboardView() {
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('propertiesView').classList.add('hidden');
            document.getElementById('agentsView').classList.add('hidden');
            document.getElementById('pendingListingsView').classList.add('hidden');
            document.getElementById('sellerApplicationsView').classList.add('hidden');
            document.getElementById('accountsView').classList.add('hidden');

            // Reset Navs
            resetAllNavs();
            const nav = document.getElementById('navDashboard');
            nav.classList.add('bg-blue-50', 'text-blue-600');
            nav.classList.remove('text-gray-600', 'hover:bg-gray-50', 'hover:text-blue-600');

            // Update indicators
            document.getElementById('dashboardIndicator').classList.remove('hidden');
            document.getElementById('propertiesIndicator').classList.add('hidden');
            document.getElementById('agentsIndicator').classList.add('hidden');

            loadDashboardStats();
            if (window.innerWidth < 768) closeSidebar();
        }

        function showPropertiesView() {
            document.getElementById('propertiesView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('agentsView').classList.add('hidden');
            document.getElementById('pendingListingsView').classList.add('hidden');
            document.getElementById('sellerApplicationsView').classList.add('hidden');
            document.getElementById('accountsView').classList.add('hidden');

            // Reset Navs
            resetAllNavs();
            const nav = document.getElementById('navProperties');
            nav.classList.add('bg-blue-50', 'text-blue-600');
            nav.classList.remove('text-gray-600', 'hover:bg-gray-50', 'hover:text-blue-600');

            // Update indicators
            document.getElementById('propertiesIndicator').classList.remove('hidden');
            document.getElementById('dashboardIndicator').classList.add('hidden');
            document.getElementById('agentsIndicator').classList.add('hidden');

            loadPropertiesTable();
            if (window.innerWidth < 768) closeSidebar();
        }

        function showAgentsView() {
            document.getElementById('agentsView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('propertiesView').classList.add('hidden');
            document.getElementById('pendingListingsView').classList.add('hidden');
            document.getElementById('sellerApplicationsView').classList.add('hidden');
            document.getElementById('accountsView').classList.add('hidden');

            // Reset Navs
            resetAllNavs();
            const nav = document.getElementById('navAgents');
            nav.classList.add('bg-blue-50', 'text-blue-600');
            nav.classList.remove('text-gray-600', 'hover:bg-gray-50', 'hover:text-blue-600');

            // Update indicators
            document.getElementById('agentsIndicator').classList.remove('hidden');
            document.getElementById('dashboardIndicator').classList.add('hidden');
            document.getElementById('propertiesIndicator').classList.add('hidden');

            loadAgentsGrid();
            if (window.innerWidth < 768) closeSidebar();
        }

        function showPendingListingsView() {
            document.getElementById('pendingListingsView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('propertiesView').classList.add('hidden');
            document.getElementById('agentsView').classList.add('hidden');
            document.getElementById('sellerApplicationsView').classList.add('hidden');
            document.getElementById('accountsView').classList.add('hidden');

            // Reset Navs
            resetAllNavs();
            const nav = document.getElementById('navPendingListings');
            nav.classList.add('bg-orange-50', 'text-orange-600');
            nav.classList.remove('text-gray-600', 'hover:bg-gray-50', 'hover:text-orange-600');

            // Indicators
            document.getElementById('dashboardIndicator').classList.add('hidden');
            document.getElementById('propertiesIndicator').classList.add('hidden');
            document.getElementById('agentsIndicator').classList.add('hidden');

            loadPendingListings();
            if (window.innerWidth < 768) closeSidebar();
        }

        function showSellerApplicationsView() {
            document.getElementById('sellerApplicationsView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('propertiesView').classList.add('hidden');
            document.getElementById('agentsView').classList.add('hidden');
            document.getElementById('pendingListingsView').classList.add('hidden');
            document.getElementById('accountsView').classList.add('hidden');

            // Reset Navs
            resetAllNavs();
            const nav = document.getElementById('navSellerApplications');
            nav.classList.add('bg-purple-50', 'text-purple-600');
            nav.classList.remove('text-gray-600', 'hover:bg-gray-50', 'hover:text-purple-600');

            // Indicators
            document.getElementById('dashboardIndicator').classList.add('hidden');
            document.getElementById('propertiesIndicator').classList.add('hidden');
            document.getElementById('agentsIndicator').classList.add('hidden');

            loadSellerApplications();
            if (window.innerWidth < 768) closeSidebar();
        }

        function showAccountsView() {
            document.getElementById('accountsView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('propertiesView').classList.add('hidden');
            document.getElementById('agentsView').classList.add('hidden');
            document.getElementById('pendingListingsView').classList.add('hidden');
            document.getElementById('sellerApplicationsView').classList.add('hidden');

            // Reset Navs
            resetAllNavs();
            const nav = document.getElementById('navAccounts');
            nav.classList.add('bg-teal-50', 'text-teal-600');
            nav.classList.remove('text-gray-600', 'hover:bg-gray-50', 'hover:text-teal-600');

            // Indicators
            document.getElementById('dashboardIndicator').classList.add('hidden');
            document.getElementById('propertiesIndicator').classList.add('hidden');
            document.getElementById('agentsIndicator').classList.add('hidden');

            loadAccounts();
            if (window.innerWidth < 768) closeSidebar();
        }

        function resetAllNavs() {
            const navs = [
                { id: 'navDashboard', hover: 'hover:text-blue-600' },
                { id: 'navProperties', hover: 'hover:text-blue-600' },
                { id: 'navAgents', hover: 'hover:text-blue-600' },
                { id: 'navPendingListings', hover: 'hover:text-orange-600' },
                { id: 'navSellerApplications', hover: 'hover:text-purple-600' },
                { id: 'navAccounts', hover: 'hover:text-teal-600' }
            ];

            navs.forEach(item => {
                const el = document.getElementById(item.id);
                if (el) {
                    el.classList.remove('bg-blue-50', 'text-blue-600', 'bg-orange-50', 'text-orange-600', 'bg-purple-50', 'text-purple-600', 'bg-teal-50', 'text-teal-600');
                    el.classList.add('text-gray-600', 'hover:bg-gray-50', item.hover);
                }
            });
        }


        // ==================== PENDING LISTINGS ====================
        async function loadPendingCount() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/listings/pending`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) return;
                const listings = await response.json();
                document.getElementById('pendingListingsCount').textContent = listings.length;
            } catch (error) {
                console.error('Error loading pending count:', error);
            }
        }

        async function loadPendingListings() {
            const tableBody = document.getElementById('pendingListingsTableBody');
            const emptyState = document.getElementById('emptyPendingState');

            try {
                const response = await fetch(`${API_BASE}/api/admin/listings/pending`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) throw new Error('Failed to fetch pending listings');

                const listings = await response.json();

                // Update badge count
                document.getElementById('pendingListingsCount').textContent = listings.length;

                if (listings.length === 0) {
                    tableBody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                tableBody.innerHTML = listings.map(listing => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <img src="${listing.imageUrl || 'https://placehold.co/64x64/e5e7eb/9ca3af?text=No+Image'}" 
                                     alt="${listing.title}" 
                                     class="w-12 h-12 rounded-lg object-cover mr-3 border border-gray-200">
                                <div>
                                    <p class="font-semibold text-gray-800">${listing.title || 'Untitled'}</p>
                                    <p class="text-xs text-gray-500">${listing.bedrooms || 0} bed · ${listing.bathrooms || 0} bath · ${listing.areaSqFt || 0} sqft</p>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <p class="font-semibold text-gray-800">Rs. ${(listing.price || 0).toLocaleString()}</p>
                            <p class="text-xs text-gray-500">${listing.type === 'RENT' ? 'For Rent' : 'For Sale'}</p>
                        </td>
                        <td class="px-6 py-4">
                            <p class="text-gray-600">${listing.address || 'N/A'}</p>
                        </td>
                        <td class="px-6 py-4">
                            <div>
                                <p class="font-medium text-gray-800">${listing.ownerName || 'Unknown'}</p>
                                <p class="text-xs text-gray-500">${listing.ownerPhone || ''}</p>
                                <p class="text-xs text-gray-500">${listing.ownerEmail || ''}</p>
                                <p class="text-xs mt-1">
                                    ${listing.driveLink
                        ? `<a href="${listing.driveLink}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 hover:underline">Open Drive</a>`
                        : '<span class="text-gray-400">Resource: N/A</span>'}
                                </p>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <p class="text-gray-600">${listing.createdAt ? new Date(listing.createdAt).toLocaleDateString() : 'N/A'}</p>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-2">
                                <button onclick="viewPropertyDetails(${listing.id})"
                                    class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                    View
                                </button>
                                <button onclick="approveListing(${listing.id})"
                                    class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    Approve
                                </button>
                                <button onclick="rejectListing(${listing.id})"
                                    class="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap=" round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Reject
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error loading pending listings:', error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center">
                            <p class="text-red-500">Failed to load pending listings. Please try again.</p>
                        </td>
                    </tr>
                `;
            }
        }

        async function approveListing(id) {
            if (!confirm('Are you sure you want to approve this listing?')) return;
            const message = prompt('Approval message to user:', 'Your listing has been approved.');
            if (!message || message.trim() === '') {
                alert('Approval message is required.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/listings/${id}/approve`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ message: message.trim() })
                });

                if (!response.ok) throw new Error('Failed to approve listing');

                const result = await response.json();
                alert(result.message || 'Listing approved successfully!');
                loadPendingListings(); // Refresh the list
                loadDashboardStats(); // Update stats
            } catch (error) {
                console.error('Error approving listing:', error);
                alert('Failed to approve listing. Please try again.');
            }
        }


        async function rejectListing(id) {
            const reason = prompt('Please provide a reason for rejection:');
            if (!reason || reason.trim() === '') {
                alert('Rejection reason is required.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/listings/${id}/reject`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ message: reason.trim() })
                });

                if (!response.ok) throw new Error('Failed to reject listing');

                const result = await response.json();
                alert(result.message || 'Listing rejected successfully!');
                loadPendingListings(); // Refresh the list
                loadDashboardStats(); // Update stats
            } catch (error) {
                console.error('Error rejecting listing:', error);
                alert('Failed to reject listing. Please try again.');
            }
        }


        // ==================== SELLER APPLICATIONS ====================
        async function loadSellerApplicationsCount() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/sellers/pending`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) return;
                const apps = await response.json();
                const badge = document.getElementById('sellerApplicationsCount');
                if (apps.length > 0) {
                    badge.textContent = apps.length;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            } catch (error) {
                console.error('Error loading seller app count:', error);
            }
        }

        async function loadSellerApplications() {
            const tableBody = document.getElementById('sellerApplicationsTableBody');
            const emptyState = document.getElementById('emptySellerApplicationsState');

            try {
                const response = await fetch(`${API_BASE}/api/admin/sellers/pending`, {
                    headers: getAuthHeaders()
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const apps = await response.json();

                // Update badge
                const badge = document.getElementById('sellerApplicationsCount');
                if (apps.length > 0) {
                    badge.textContent = apps.length;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }

                if (apps.length === 0) {
                    tableBody.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }

                emptyState.classList.add('hidden');
                tableBody.innerHTML = apps.map(app => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-bold mr-3">
                                    ${app.fullName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800">${app.fullName}</p>
                                    <p class="text-xs text-gray-500">${app.email}</p>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <p class="text-gray-800">${app.phone}</p>
                        </td>
                        <td class="px-6 py-4">
                             <p class="text-gray-600">${app.cityOrDistrict || ''}</p>
                             <p class="text-xs text-gray-500 line-clamp-1" title="${app.address || ''}">${app.address || ''}</p>
                        </td>
                        <td class="px-6 py-4">
                            <p class="text-gray-600">${app.nicOrCompanyRegNo || 'N/A'}</p>
                        </td>
                        <td class="px-6 py-4">
                            <p class="text-gray-600">${app.createdAt ? new Date(app.createdAt).toLocaleDateString() : 'N/A'}</p>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-2">
                                <button onclick="approveSeller(${app.id})"
                                    class="px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm font-medium hover:bg-green-200 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    Approve
                                </button>
                                <button onclick="rejectSeller(${app.id})"
                                    class="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                    Reject
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error loading seller applications:', error);
                tableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-12 text-center text-red-500">Failed to load applications.</td></tr>';
            }
        }

        async function approveSeller(id) {
            if (!confirm('Approve this seller? They will receive an email to set their password.')) return;
            try {
                const response = await fetch(`${API_BASE}/api/admin/sellers/${id}/approve`, {
                    method: 'POST',
                    headers: getAuthHeaders()
                });
                if (!response.ok) throw new Error('Failed to approve');
                alert('Seller approved successfully!');
                loadSellerApplications();
            } catch (err) {
                console.error(err);
                alert('Error approving seller');
            }
        }

        async function rejectSeller(id) {
            const reason = prompt("Enter rejection reason:", "Incomplete application details");
            if (reason === null) return; // Cancelled

            try {
                const response = await fetch(`${API_BASE}/api/admin/sellers/${id}/reject-with-reason`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ reason })
                });
                if (!response.ok) throw new Error('Failed to reject');
                alert('Seller rejected.');
                loadSellerApplications();
            } catch (err) {
                console.error(err);
                alert('Error rejecting seller');
            }
        }

        // ==================== PROPERTIES TABLE ====================
        async function loadPropertiesTable() {
            const tableBody = document.getElementById('propertiesTableBody');

            try {
                const response = await fetch(`${API_BASE}/api/properties`);
                if (!response.ok) throw new Error('Failed to fetch properties');

                const properties = await response.json();

                if (properties.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center">
                                <div class="flex flex-col items-center justify-center">
                                    <svg class="w-12 h-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                    <span class="text-gray-500">No properties found</span>
                                    <button onclick="openAddPropertyModal()" class="mt-3 text-blue-600 hover:text-blue-800 font-medium">+ Add your first property</button>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Sort properties by ID descending (newest first)
                properties.sort((a, b) => b.id - a.id);

                tableBody.innerHTML = properties.map(property => {
                    const statusConfig = {
                        'AVAILABLE': { bg: 'bg-green-50', text: 'text-green-600', border: 'border-green-100', label: 'Active' },
                        'PENDING': { bg: 'bg-yellow-50', text: 'text-yellow-600', border: 'border-yellow-100', label: 'Pending' },
                        'SOLD': { bg: 'bg-red-50', text: 'text-red-600', border: 'border-red-100', label: 'Sold' },
                        'RENTED': { bg: 'bg-purple-50', text: 'text-purple-600', border: 'border-purple-100', label: 'Rented' }
                    };
                    const status = statusConfig[property.status] || statusConfig['AVAILABLE'];

                    const typeConfig = {
                        'SALE': { bg: 'bg-blue-50', text: 'text-blue-600', border: 'border-blue-100', label: 'House' },
                        'RENT': { bg: 'bg-purple-50', text: 'text-purple-600', border: 'border-purple-100', label: 'Rental' }
                    };
                    const type = typeConfig[property.type] || typeConfig['SALE'];

                    const agentName = property.agent ? property.agent.name : 'Admin';
                    const agentInitial = agentName.charAt(0).toUpperCase();

                    return `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center">
                                    <div class="h-10 w-10 rounded-lg bg-gray-200 mr-3 overflow-hidden flex-shrink-0">
                                        <img src="${property.imageUrl || 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?auto=format&fit=crop&w=100&q=80'}" 
                                             alt="${property.title}" 
                                             class="w-full h-full object-cover"
                                             onerror="this.src='https://images.unsplash.com/photo-1564013799919-ab600027ffc6?auto=format&fit=crop&w=100&q=80'">
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800 line-clamp-1">${property.title}</p>
                                        <p class="text-xs text-gray-500">Ref: #PROP-${String(property.id).padStart(3, '0')}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="font-bold text-gray-900">LKR ${property.price ? property.price.toLocaleString() : '0'}</span>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-3 py-1 text-xs font-semibold ${type.text} ${type.bg} rounded-full border ${type.border}">${type.label}</span>
                            </td>
                            <td class="px-6 py-4 text-gray-600">${property.address || 'N/A'}</td>
                            <td class="px-6 py-4 text-gray-600">
                                <div class="flex items-center">
                                    <div class="h-6 w-6 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold mr-2">${agentInitial}</div>
                                    ${agentName}
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-3 py-1 text-xs font-semibold ${status.text} ${status.bg} rounded-full border ${status.border}">${status.label}</span>
                            </td>
                            <td class="px-6 py-4">
                                <button onclick="openEditPropertyModal(${property.id})" class="text-blue-600 hover:text-blue-800 font-medium">Edit</button>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Update pagination info
                const paginationInfo = document.querySelector('.px-6.py-4.border-t p');
                if (paginationInfo) {
                    paginationInfo.textContent = `Showing 1 to ${properties.length} of ${properties.length} data`;
                }

            } catch (error) {
                console.error('Error loading properties:', error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center">
                            <div class="flex flex-col items-center justify-center">
                                <svg class="w-12 h-12 text-red-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                                <span class="text-red-500">Error loading properties</span>
                                <button onclick="loadPropertiesTable()" class="mt-3 text-blue-600 hover:text-blue-800 font-medium">Try Again</button>
                            </div>
                        </td>
                    </tr>
                `;
            }
        }

        // ==================== DASHBOARD STATS ====================
        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/stats`);
                if (!response.ok) throw new Error('Failed to fetch stats');

                const stats = await response.json();

                // Update stat cards
                document.getElementById('statTotalUsers').textContent = stats.totalUsers || 0;
                document.getElementById('statTotalProperties').textContent = stats.totalProperties || 0;
                document.getElementById('statActiveListings').textContent = stats.activeListings || 0;
                document.getElementById('statPendingProperties').textContent = stats.pendingProperties || 0;
                document.getElementById('statSoldProperties').textContent = stats.soldProperties || 0;
                document.getElementById('statRentedProperties').textContent = stats.rentedProperties || 0;

                // Calculate success rate
                const successCount = (stats.soldProperties || 0) + (stats.rentedProperties || 0);
                const totalProps = stats.totalProperties || 1;
                const rate = totalProps > 0 ? Math.round((successCount / totalProps) * 100) : 0;
                document.getElementById('statSuccessRate').textContent = rate + '%';
                document.getElementById('statSuccessDetail').textContent = `${successCount} of ${totalProps}`;

                // Also update welcome name
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                const welcomeName = document.getElementById('welcomeAdminName');
                if (welcomeName) welcomeName.textContent = user.name || 'Admin';

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // ==================== MODAL CONTROL ====================
        // Load agents for dropdown selectors
        async function loadAgentsForDropdown(selectId = 'assignedAgentId', selectedAgentId = null) {
            const select = document.getElementById(selectId);
            if (!select) return;

            try {
                const response = await fetch(`${API_BASE}/api/agents/public`);
                if (!response.ok) throw new Error('Failed to fetch agents');
                const agents = await response.json();

                // Keep the first option (placeholder)
                const firstOption = select.options[0];
                select.innerHTML = '';
                select.appendChild(firstOption);

                // Add agent options
                agents.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.id;
                    option.textContent = `${agent.name}${agent.specialization ? ' - ' + agent.specialization : ''}`;
                    if (selectedAgentId && agent.id == selectedAgentId) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading agents for dropdown:', error);
            }
        }

        function openAddPropertyModal() {
            const modal = document.getElementById('addPropertyModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('addPropertyForm').reset();
            document.getElementById('imagePreviewContainer').classList.add('hidden');
            document.getElementById('descCharCount').textContent = '0';

            // Load agents for dropdown
            loadAgentsForDropdown('assignedAgentId');
        }

        function closeAddPropertyModal() {
            const modal = document.getElementById('addPropertyModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // ==================== IMAGE PREVIEW ====================
        function previewPropertyImage(url) {
            const container = document.getElementById('imagePreviewContainer');
            const img = document.getElementById('imagePreview');

            if (url && url.trim()) {
                img.src = url;
                container.classList.remove('hidden');

                // Handle image load error
                img.onerror = () => {
                    container.classList.add('hidden');
                };
            } else {
                container.classList.add('hidden');
            }
        }

        
        function showToast(message, isError = false) {
            const toast = document.getElementById('successToast');
            const toastMessage = document.getElementById('toastMessage');

            toastMessage.textContent = message;
            toast.classList.remove('translate-y-20', 'opacity-0');

            if (isError) {
                toast.classList.remove('bg-blue-500');
                toast.classList.add('bg-red-500');
            } else {
                toast.classList.remove('bg-red-500');
                toast.classList.add('bg-blue-500');
            }

            // Auto hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // ==================== FORM SUBMISSION ====================
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('addPropertyForm');
            const descTextarea = form.querySelector('textarea[name="description"]');

            // Character count for description
            if (descTextarea) {
                descTextarea.addEventListener('input', () => {
                    document.getElementById('descCharCount').textContent = descTextarea.value.length;
                });
            }

            // Load pending listings count for sidebar badge
            loadPendingCount();
            loadSellerApplicationsCount();

            // Form submit handler
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const submitBtn = document.getElementById('submitPropertyBtn');
                const originalText = submitBtn.innerHTML;

                try {
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Creating...
                    `;

                    // Build property data
                    const formData = new FormData(form);

                    // Handle Facilities
                    const facilities = [];
                    form.querySelectorAll('input[name="facilities[]"]:checked').forEach(cb => {
                        facilities.push(cb.value);
                    });

                    // Handle Additional Images
                    const additionalImagesRaw = formData.get('additionalImages');
                    const additionalImages = additionalImagesRaw ? additionalImagesRaw.split(',').map(s => s.trim()).filter(s => s) : [];

                    const propertyData = {
                        title: formData.get('title'),
                        description: formData.get('description') || null,
                        address: formData.get('address'),
                        price: parseFloat(formData.get('price')),
                        type: formData.get('type'),
                        status: formData.get('status'),
                        imageUrl: formData.get('imageUrl') || null,
                        bedrooms: formData.get('bedrooms') ? parseInt(formData.get('bedrooms')) : null,
                        bathrooms: formData.get('bathrooms') ? parseInt(formData.get('bathrooms')) : null,
                        areaSqFt: formData.get('areaSqFt') ? parseFloat(formData.get('areaSqFt')) : null,
                        // New Fields
                        facilities: facilities,
                        imageUrls: additionalImages,
                        houseRules: formData.get('houseRules') || null,
                        // Assigned Agent
                        assignedAgent: formData.get('assignedAgentId') ? { id: parseInt(formData.get('assignedAgentId')) } : null
                    };

                    
                    const response = await fetch(`${API_BASE}/api/properties`, {
                        method: 'POST',
                        headers: getAuthHeaders(),
                        body: JSON.stringify(propertyData)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to create property');
                    }

                    const result = await response.json();

                    // Success
                    closeAddPropertyModal();
                    showToast('Property created successfully!');

                    // Reload stats and properties table
                    loadDashboardStats();
                    if (!document.getElementById('propertiesView').classList.contains('hidden')) {
                        loadPropertiesTable();
                    }

                } catch (error) {
                    console.error('Error creating property:', error);
                    showToast('Failed to create property. Please try again.', true);
                } finally {
                    // Restore button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            });

            // Load stats on page load
            loadDashboardStats();
        });

        // ==================== MOBILE SIDEBAR TOGGLE ====================
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            if (sidebar.classList.contains('-translate-x-full')) {
                openSidebar();
            } else {
                closeSidebar();
            }
        }

        function openSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.remove('-translate-x-full');
            sidebar.classList.add('translate-x-0');
            overlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebar.classList.add('-translate-x-full');
            sidebar.classList.remove('translate-x-0');
            overlay.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Close sidebar on window resize to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                closeSidebar();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAddPropertyModal();
                closeEditPropertyModal();
            }
        });

        // ==================== EDIT PROPERTY MODAL ====================
        let currentEditPropertyId = null;

        async function openEditPropertyModal(propertyId) {
            currentEditPropertyId = propertyId;
            const modal = document.getElementById('editPropertyModal');

            try {
                const response = await fetch(`${API_BASE}/api/properties/${propertyId}`);
                if (!response.ok) throw new Error('Failed to fetch property');

                const property = await response.json();

                // Populate form fields
                document.getElementById('editPropertyId').value = property.id;
                document.getElementById('editTitle').value = property.title || '';
                document.getElementById('editAddress').value = property.address || '';
                document.getElementById('editPrice').value = property.price || '';
                document.getElementById('editType').value = property.type || 'SALE';
                document.getElementById('editHouseType').value = property.houseType || '';
                document.getElementById('editStatus').value = property.status || 'AVAILABLE';
                document.getElementById('editDescription').value = property.description || '';
                document.getElementById('editBedrooms').value = property.bedrooms || '';
                document.getElementById('editBathrooms').value = property.bathrooms || '';
                document.getElementById('editAreaSqFt').value = property.areaSqFt || '';
                document.getElementById('editImageUrl').value = property.imageUrl || '';

                // NEW FIELDS POPULATION
                document.getElementById('editHouseRules').value = property.houseRules || '';
                document.getElementById('editAdditionalImages').value = property.imageUrls ? property.imageUrls.join(', ') : '';

                // Facilities Checkboxes - First uncheck all
                const editFacilities = document.querySelectorAll('input[name="editFacilities[]"]');
                editFacilities.forEach(cb => cb.checked = false);

                // Check existing
                if (property.facilities) {
                    editFacilities.forEach(cb => {
                        if (property.facilities.includes(cb.value)) {
                            cb.checked = true;
                        }
                    });
                }

                // Show image preview if URL exists
                if (property.imageUrl) {
                    previewEditPropertyImage(property.imageUrl);
                } else {
                    document.getElementById('editImagePreviewContainer').classList.add('hidden');
                }

                // Load agents for dropdown and pre-select assigned agent
                const assignedAgentId = property.assignedAgent ? property.assignedAgent.id : null;
                await loadAgentsForDropdown('editAssignedAgentId', assignedAgentId);

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

            } catch (error) {
                console.error('Error loading property:', error);
                showToast('Failed to load property details', true);
            }
        }

        function closeEditPropertyModal() {
            const modal = document.getElementById('editPropertyModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            currentEditPropertyId = null;
        }

        function previewEditPropertyImage(url) {
            const container = document.getElementById('editImagePreviewContainer');
            const img = document.getElementById('editImagePreview');

            if (url && url.trim()) {
                img.src = url;
                container.classList.remove('hidden');
                img.onerror = () => container.classList.add('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        async function deleteProperty() {
            if (!currentEditPropertyId) return;

            if (!confirm('Are you sure you want to delete this property? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/properties/${currentEditPropertyId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });

                if (!response.ok) throw new Error('Failed to delete property');

                closeEditPropertyModal();
                showToast('Property deleted successfully!');
                loadPropertiesTable();
                loadDashboardStats();

            } catch (error) {
                console.error('Error deleting property:', error);
                showToast('Failed to delete property', true);
            }
        }

        // Edit form submission handler
        document.getElementById('editPropertyForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('updatePropertyBtn');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <svg class="w-4 h-4 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Saving...
                `;

                const form = document.getElementById('editPropertyForm');
                const formData = new FormData(form);

                // Handle Facilities
                const facilities = [];
                form.querySelectorAll('input[name="editFacilities[]"]:checked').forEach(cb => {
                    facilities.push(cb.value);
                });

                // Handle Additional Images
                const additionalImagesRaw = formData.get('additionalImages');
                const additionalImages = additionalImagesRaw ? additionalImagesRaw.split(',').map(s => s.trim()).filter(s => s) : [];

                const propertyData = {
                    title: formData.get('title'),
                    description: formData.get('description') || null,
                    address: formData.get('address'),
                    price: parseFloat(formData.get('price')),
                    type: formData.get('type'),
                    houseType: formData.get('houseType') || null,
                    status: formData.get('status'),
                    imageUrl: formData.get('imageUrl') || null,
                    bedrooms: formData.get('bedrooms') ? parseInt(formData.get('bedrooms')) : null,
                    bathrooms: formData.get('bathrooms') ? parseInt(formData.get('bathrooms')) : null,
                    areaSqFt: formData.get('areaSqFt') ? parseFloat(formData.get('areaSqFt')) : null,
                    // New Fields
                    facilities: facilities,
                    imageUrls: additionalImages,
                    houseRules: formData.get('houseRules') || null,
                    // Assigned Agent
                    assignedAgent: formData.get('assignedAgentId') ? { id: parseInt(formData.get('assignedAgentId')) } : null
                };

                const response = await fetch(`${API_BASE}/api/properties/${currentEditPropertyId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(propertyData)
                });

                if (!response.ok) throw new Error('Failed to update property');

                closeEditPropertyModal();
                showToast('Property updated successfully!');
                loadPropertiesTable();
                loadDashboardStats();

            } catch (error) {
                console.error('Error updating property:', error);
                showToast('Failed to update property', true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // AGENTS MANAGEMENT
        let currentEditAgentId = null;

        async function loadAgentsGrid() {
            const grid = document.getElementById('agentsGrid');

            try {
                const response = await fetch(`${API_BASE}/api/agents`);
                if (!response.ok) throw new Error('Failed to fetch agents');

                const agents = await response.json();

                // Update subtitle
                document.getElementById('agentsSubtitle').textContent = `Total Agents: ${agents.length}`;

                if (agents.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full flex flex-col items-center justify-center py-16">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <p class="text-gray-500 text-lg">No agents found</p>
                            <button onclick="openAddAgentModal()" class="mt-4 text-blue-600 hover:text-blue-800 font-medium">+ Add your first agent</button>
                        </div>
                    `;
                    return;
                }

                // Sort by ID descending (newest first)
                agents.sort((a, b) => b.id - a.id);

                grid.innerHTML = agents.map(agent => {
                    const statusColor = agent.status === 'ACTIVE'
                        ? 'bg-green-100 text-green-700 border-green-200'
                        : 'bg-gray-100 text-gray-600 border-gray-200';

                    return `
                        <div class="bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden group">
                            <!-- Agent Header -->
                            <div class="relative h-32 bg-gradient-to-r from-blue-500 to-blue-600 overflow-hidden">
                                <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.05\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-30"></div>
                                <div class="absolute -bottom-10 left-1/2 -translate-x-1/2">
                                    <img src="${agent.profileImageUrl || 'https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=150&q=80'}" 
                                         alt="${agent.name}"
                                         class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg"
                                         onerror="this.src='https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=150&q=80'">
                                </div>
                                <!-- Status Badge -->
                                <div class="absolute top-3 right-3">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor} border">
                                        ${agent.status === 'ACTIVE' ? 'Active' : 'Inactive'}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Agent Info -->
                            <div class="pt-12 pb-4 px-4 text-center">
                                <h3 class="font-bold text-gray-800 text-lg">${agent.name}</h3>
                                <p class="text-blue-600 text-sm font-medium">${agent.title || 'Real Estate Agent'}</p>
                                
                                ${agent.specialization ? `
                                <span class="inline-block mt-2 px-3 py-1 bg-purple-50 text-purple-700 text-xs font-medium rounded-full">
                                    ${agent.specialization}
                                </span>
                                ` : ''}
                            </div>
                            
                            <!-- Stats Row -->
                            <div class="px-4 py-3 border-t border-gray-100 flex items-center justify-around text-center">
                                <div>
                                    <p class="text-lg font-bold text-gray-800">${agent.experience || 0}</p>
                                    <p class="text-xs text-gray-500">Years</p>
                                </div>
                                <div class="w-px h-8 bg-gray-200"></div>
                                <div>
                                    <p class="text-lg font-bold text-gray-800">${agent.propertiesSold || 0}</p>
                                    <p class="text-xs text-gray-500">Sold</p>
                                </div>
                                <div class="w-px h-8 bg-gray-200"></div>
                                <div>
                                    <div class="flex items-center justify-center">
                                        <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                        <span class="text-lg font-bold text-gray-800">${agent.rating?.toFixed(1) || '5.0'}</span>
                                    </div>
                                    <p class="text-xs text-gray-500">Rating</p>
                                </div>
                            </div>
                            
                            <!-- Qualifications -->
                            <div class="px-4 py-3 border-t border-gray-100">
                                ${agent.degree ? `<p class="text-xs text-gray-600 mb-1"><span class="font-medium">Degree:</span> ${agent.degree}</p>` : ''}
                                ${agent.qualifications ? `<p class="text-xs text-gray-600"><span class="font-medium">Qualifications:</span> ${agent.qualifications}</p>` : ''}
                            </div>
                            
                            <!-- Actions -->
                            <div class="px-4 py-3 border-t border-gray-100 flex gap-2">
                                <button onclick="openEditAgentModal(${agent.id})" 
                                    class="flex-1 px-3 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    Edit
                                </button>
                                <a href="mailto:${agent.email || '#'}" 
                                    class="flex-1 px-3 py-2 border border-gray-200 text-gray-600 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    Email
                                </a>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading agents:', error);
                grid.innerHTML = `
                    <div class="col-span-full flex flex-col items-center justify-center py-16">
                        <svg class="w-16 h-16 text-red-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <p class="text-red-500 text-lg">Error loading agents</p>
                        <button onclick="loadAgentsGrid()" class="mt-4 text-blue-600 hover:text-blue-800 font-medium">Try Again</button>
                    </div>
                `;
            }
        }

        // Agent Image Preview
        function previewAgentImage(url, imgId, containerId) {
            const container = document.getElementById(containerId);
            const img = document.getElementById(imgId);

            if (url && url.trim()) {
                img.src = url;
                container.classList.remove('hidden');
                img.onerror = () => container.classList.add('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        // Add Agent Modal
        function openAddAgentModal() {
            const modal = document.getElementById('addAgentModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            document.getElementById('addAgentForm').reset();
            document.getElementById('addAgentImagePreviewContainer').classList.add('hidden');
        }

        function closeAddAgentModal() {
            const modal = document.getElementById('addAgentModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Edit Agent Modal
        async function openEditAgentModal(agentId) {
            currentEditAgentId = agentId;
            const modal = document.getElementById('editAgentModal');

            try {
                const response = await fetch(`${API_BASE}/api/agents/${agentId}`);
                if (!response.ok) throw new Error('Failed to fetch agent');

                const agent = await response.json();

                // Populate form fields
                document.getElementById('editAgentId').value = agent.id;
                document.getElementById('editAgentName').value = agent.name || '';
                document.getElementById('editAgentEmail').value = agent.email || '';
                document.getElementById('editAgentPhone').value = agent.phone || '';
                document.getElementById('editAgentTitle').value = agent.title || '';
                document.getElementById('editAgentSpecialization').value = agent.specialization || '';
                document.getElementById('editAgentStatus').value = agent.status || 'ACTIVE';
                document.getElementById('editAgentDegree').value = agent.degree || '';
                document.getElementById('editAgentQualifications').value = agent.qualifications || '';
                document.getElementById('editAgentExperience').value = agent.experience || '';
                document.getElementById('editAgentPropertiesSold').value = agent.propertiesSold || '';
                document.getElementById('editAgentRating').value = agent.rating || '';
                document.getElementById('editAgentBio').value = agent.bio || '';
                document.getElementById('editAgentProfileImageUrl').value = agent.profileImageUrl || '';

                // Show image preview if URL exists
                if (agent.profileImageUrl) {
                    previewAgentImage(agent.profileImageUrl, 'editAgentImagePreview', 'editAgentImagePreviewContainer');
                } else {
                    document.getElementById('editAgentImagePreviewContainer').classList.add('hidden');
                }

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

            } catch (error) {
                console.error('Error loading agent:', error);
                showToast('Failed to load agent details', true);
            }
        }

        function closeEditAgentModal() {
            const modal = document.getElementById('editAgentModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            currentEditAgentId = null;
        }

        // Delete Agent
        async function deleteAgent() {
            if (!currentEditAgentId) return;

            if (!confirm('Are you sure you want to delete this agent? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/agents/${currentEditAgentId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete agent');

                closeEditAgentModal();
                showToast('Agent deleted successfully!');
                loadAgentsGrid();
                loadDashboardStats();

            } catch (error) {
                console.error('Error deleting agent:', error);
                showToast('Failed to delete agent', true);
            }
        }

        // Add Agent Form Submission
        document.getElementById('addAgentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('submitAgentBtn');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <svg class="w-4 h-4 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Creating...
                `;

                const form = document.getElementById('addAgentForm');
                const formData = new FormData(form);

                const agentData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone') || null,
                    title: formData.get('title'),
                    specialization: formData.get('specialization') || null,
                    status: formData.get('status'),
                    degree: formData.get('degree') || null,
                    qualifications: formData.get('qualifications') || null,
                    experience: formData.get('experience') ? parseInt(formData.get('experience')) : null,
                    propertiesSold: formData.get('propertiesSold') ? parseInt(formData.get('propertiesSold')) : 0,
                    rating: formData.get('rating') ? parseFloat(formData.get('rating')) : 5.0,
                    bio: formData.get('bio') || null,
                    profileImageUrl: formData.get('profileImageUrl') || null
                };

                const response = await fetch(`${API_BASE}/api/agents`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(agentData)
                });

                if (!response.ok) throw new Error('Failed to create agent');

                closeAddAgentModal();
                showToast('Agent created successfully!');
                loadAgentsGrid();
                loadDashboardStats();

            } catch (error) {
                console.error('Error creating agent:', error);
                showToast('Failed to create agent. Please try again.', true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Edit Agent Form Submission
        document.getElementById('editAgentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('updateAgentBtn');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <svg class="w-4 h-4 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Saving...
                `;

                const form = document.getElementById('editAgentForm');
                const formData = new FormData(form);

                const agentData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone') || null,
                    title: formData.get('title'),
                    specialization: formData.get('specialization') || null,
                    status: formData.get('status'),
                    degree: formData.get('degree') || null,
                    qualifications: formData.get('qualifications') || null,
                    experience: formData.get('experience') ? parseInt(formData.get('experience')) : null,
                    propertiesSold: formData.get('propertiesSold') ? parseInt(formData.get('propertiesSold')) : 0,
                    rating: formData.get('rating') ? parseFloat(formData.get('rating')) : 5.0,
                    bio: formData.get('bio') || null,
                    profileImageUrl: formData.get('profileImageUrl') || null
                };

                const response = await fetch(`${API_BASE}/api/agents/${currentEditAgentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(agentData)
                });

                if (!response.ok) throw new Error('Failed to update agent');

                closeEditAgentModal();
                showToast('Agent updated successfully!');
                loadAgentsGrid();
                loadDashboardStats();

            } catch (error) {
                console.error('Error updating agent:', error);
                showToast('Failed to update agent', true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Close agent modals on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAddAgentModal();
                closeEditAgentModal();
            }
        });
        // ==================== SELLER ACCOUNTS ====================
        async function loadAccounts() {
            const tableBody = document.getElementById('accountsTableBody');

            try {
                const headers = getAuthHeaders();
                const response = await fetch(`${API_BASE}/api/admin/sellers/pre-generated`, {
                    headers: headers
                });

                if (!response.ok) throw new Error('Failed to fetch accounts');

                const accounts = await response.json();

                if (accounts.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="3" class="px-6 py-4 text-center text-gray-500">No pre-generated accounts found.</td></tr>`;
                    return;
                }

                tableBody.innerHTML = accounts.map(acc => `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">${acc.username}</div>
                        </td>
                        <td class="px-6 py-4">
                            <code class="px-2 py-1 bg-gray-100 rounded text-sm font-mono text-gray-600">${acc.password}</code>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="copyToClipboard('${acc.username}', '${acc.password}')" 
                                class="text-teal-600 hover:text-teal-800 font-medium flex items-center justify-end ml-auto group">
                                <span class="mr-2 group-hover:underline">Copy</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                                </svg>
                            </button>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error loading accounts:', error);
                tableBody.innerHTML = `<tr><td colspan="3" class="px-6 py-4 text-center text-red-500">Error loading accounts</td></tr>`;
            }
        }

        function copyToClipboard(username, password) {
            const text = `Username: ${username}\nPassword: ${password}`;
            navigator.clipboard.writeText(text).then(() => {
                showToast('Credentials copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showToast('Failed to copy credentials', true);
            });
        }
        function closeAddAccountModal() {
            document.getElementById('addAccountModal').classList.add('hidden');
            document.getElementById('addAccountForm').reset();
        }

        function openAddAccountModal() {
            document.getElementById('addAccountModal').classList.remove('hidden');
        }

        document.getElementById('addAccountForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = 'Creating...';

                const response = await fetch(`${API_BASE}/api/admin/sellers/manual`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        username: formData.get('username'),
                        password: formData.get('password')
                    })
                });

                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(text || 'Failed to create account');
                }

                showToast('Account created successfully');
                closeAddAccountModal();
                loadAccounts();
            } catch (error) {
                console.error('Error creating account:', error);
                showToast(error.message, true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Close account modal on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAddAccountModal();
            }
        });

        // ==================== VIEW PROPERTY DETAILS ====================
        let currentViewPropertyId = null;

        async function viewPropertyDetails(id) {
            currentViewPropertyId = id;
            const modal = document.getElementById('viewPropertyModal');
            const loadingEl = document.getElementById('viewPropertyLoading');
            const dataEl = document.getElementById('viewPropertyData');

            // Show modal with loading state
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            loadingEl.classList.remove('hidden');
            dataEl.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE}/api/properties/${id}`);
                if (!response.ok) throw new Error('Failed to fetch property details');

                const property = await response.json();

                // Populate modal with property data
                populatePropertyModal(property);

                // Hide loading, show data
                loadingEl.classList.add('hidden');
                dataEl.classList.remove('hidden');

                // Show/hide action buttons based on status
                const actionsDiv = document.getElementById('viewPropertyActions');
                if (property.status === 'PENDING') {
                    actionsDiv.classList.remove('hidden');
                } else {
                    actionsDiv.classList.add('hidden');
                }

            } catch (error) {
                console.error('Error fetching property details:', error);
                loadingEl.innerHTML = `
                    <svg class="w-12 h-12 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    <span class="text-red-500">Failed to load property details</span>
                    <button onclick="viewPropertyDetails(${id})" class="mt-3 text-blue-600 hover:text-blue-800 font-medium">Try Again</button>
                `;
            }
        }

        function populatePropertyModal(property) {
            // Title & Address
            document.getElementById('viewPropertyTitle').textContent = property.title || 'Untitled Property';
            document.getElementById('viewPropertyAddress').querySelector('span').textContent = property.address || 'N/A';

            // Price & Type
            document.getElementById('viewPropertyPrice').textContent = `Rs. ${(property.price || 0).toLocaleString()}`;
            const typeEl = document.getElementById('viewPropertyType');
            if (property.type === 'RENT') {
                typeEl.textContent = 'For Rent';
                typeEl.className = 'px-3 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-700';
            } else {
                typeEl.textContent = 'For Sale';
                typeEl.className = 'px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-700';
            }

            // Features
            document.getElementById('viewPropertyBedrooms').textContent = property.bedrooms || 0;
            document.getElementById('viewPropertyBathrooms').textContent = property.bathrooms || 0;
            document.getElementById('viewPropertyArea').textContent = property.areaSqFt || 0;

            // Description
            const descSection = document.getElementById('viewPropertyDescSection');
            const descEl = document.getElementById('viewPropertyDescription');
            if (property.description) {
                descEl.textContent = property.description;
                descSection.classList.remove('hidden');
            } else {
                descSection.classList.add('hidden');
            }

            // Facilities
            const facilitiesSection = document.getElementById('viewPropertyFacilitiesSection');
            const facilitiesEl = document.getElementById('viewPropertyFacilities');
            if (property.facilities && property.facilities.length > 0) {
                facilitiesEl.innerHTML = property.facilities.map(f =>
                    `<span class="px-3 py-1 bg-blue-50 text-blue-700 text-sm rounded-full">${f}</span>`
                ).join('');
                facilitiesSection.classList.remove('hidden');
            } else {
                facilitiesSection.classList.add('hidden');
            }

            // House Rules
            const rulesSection = document.getElementById('viewPropertyRulesSection');
            const rulesEl = document.getElementById('viewPropertyRules');
            if (property.houseRules) {
                rulesEl.textContent = property.houseRules;
                rulesSection.classList.remove('hidden');
            } else {
                rulesSection.classList.add('hidden');
            }

            // Owner Info
            document.getElementById('viewPropertyOwnerName').textContent = property.ownerName || 'N/A';
            const phoneEl = document.getElementById('viewPropertyOwnerPhone');
            phoneEl.textContent = property.ownerPhone || 'N/A';
            phoneEl.href = property.ownerPhone ? `tel:${property.ownerPhone}` : '#';
            const emailEl = document.getElementById('viewPropertyOwnerEmail');
            emailEl.textContent = property.ownerEmail || 'N/A';
            emailEl.href = property.ownerEmail ? `mailto:${property.ownerEmail}` : '#';

            // Drive Resource
            const driveSection = document.getElementById('viewPropertyDriveSection');
            const driveLinkEl = document.getElementById('viewPropertyDriveLink');
            if (property.driveLink) {
                driveLinkEl.href = property.driveLink;
                driveSection.classList.remove('hidden');
            } else {
                driveLinkEl.href = '#';
                driveSection.classList.add('hidden');
            }

            // Created At
            document.getElementById('viewPropertyCreatedAt').textContent = property.createdAt
                ? new Date(property.createdAt).toLocaleDateString('en-US', { dateStyle: 'long' })
                : 'N/A';

            
            const imagesSection = document.getElementById('viewPropertyImages');
            const mainImgEl = document.getElementById('viewPropertyMainImg');
            const thumbnailsEl = document.getElementById('viewPropertyThumbnails');

            // Collect all image URLs
            let allImages = [];

            // Add main imageUrl if present
            if (property.imageUrl) {
                allImages.push(property.imageUrl);
            }

            // Add imageUrls array if present
            if (property.imageUrls && property.imageUrls.length > 0) {
                allImages = allImages.concat(property.imageUrls);
            }

            // Add mediaFiles if present
            if (property.mediaFiles && property.mediaFiles.length > 0) {
                property.mediaFiles.forEach(media => {
                    if (media.filePath && !allImages.includes(media.filePath)) {
                        allImages.push(media.filePath);
                    }
                });
            }

            if (allImages.length > 0) {
                imagesSection.classList.remove('hidden');
                mainImgEl.src = allImages[0];
                mainImgEl.onerror = () => { mainImgEl.src = 'https://placehold.co/600x400/e5e7eb/9ca3af?text=No+Image'; };

                // Create thumbnails
                if (allImages.length > 1) {
                    thumbnailsEl.innerHTML = allImages.map((img, idx) => `
                        <img src="${img}" 
                             alt="Property Image ${idx + 1}" 
                             class="h-16 w-full object-cover rounded-lg cursor-pointer border-2 ${idx === 0 ? 'border-blue-500' : 'border-transparent'} hover:border-blue-400 transition-colors"
                             onclick="selectPropertyImage('${img}', this)"
                             onerror="this.src='https://placehold.co/100x100/e5e7eb/9ca3af?text=Error'">
                    `).join('');
                } else {
                    thumbnailsEl.innerHTML = '';
                }
            } else {
                
                mainImgEl.src = 'https://placehold.co/600x400/e5e7eb/9ca3af?text=No+Images+Uploaded';
                thumbnailsEl.innerHTML = '';
            }
        }

        function selectPropertyImage(src, element) {
            document.getElementById('viewPropertyMainImg').src = src;
            // Update thumbnail borders
            const thumbnails = document.getElementById('viewPropertyThumbnails').querySelectorAll('img');
            thumbnails.forEach(img => img.classList.remove('border-blue-500'));
            element.classList.add('border-blue-500');
        }

        function closeViewPropertyModal() {
            const modal = document.getElementById('viewPropertyModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            currentViewPropertyId = null;

            // Reset loading state for next open
            document.getElementById('viewPropertyLoading').innerHTML = `
                <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                <span class="text-gray-500">Loading property details...</span>
            `;
        }

        function openImageFullscreen(src) {
            const modal = document.getElementById('imageFullscreenModal');
            const img = document.getElementById('fullscreenImage');
            img.src = src;
            modal.classList.remove('hidden');
        }

        function closeImageFullscreen() {
            document.getElementById('imageFullscreenModal').classList.add('hidden');
        }

        async function approveFromModal() {
            if (!currentViewPropertyId) return;

            if (!confirm('Are you sure you want to approve this listing?')) return;
            const message = prompt('Approval message to user:', 'Your listing has been approved.');
            if (!message || message.trim() === '') {
                alert('Approval message is required.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/listings/${currentViewPropertyId}/approve`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ message: message.trim() })
                });

                if (!response.ok) throw new Error('Failed to approve listing');

                const result = await response.json();
                showToast(result.message || 'Listing approved successfully!');
                closeViewPropertyModal();
                loadPendingListings();
                loadDashboardStats();
            } catch (error) {
                console.error('Error approving listing:', error);
                showToast('Failed to approve listing. Please try again.', true);
            }
        }

        async function rejectFromModal() {
            if (!currentViewPropertyId) return;

            const reason = prompt('Please provide a reason for rejection:');
            if (!reason || reason.trim() === '') {
                alert('Rejection reason is required.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/listings/${currentViewPropertyId}/reject`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ message: reason.trim() })
                });

                if (!response.ok) throw new Error('Failed to reject listing');

                const result = await response.json();
                showToast(result.message || 'Listing rejected successfully!');
                closeViewPropertyModal();
                loadPendingListings();
                loadDashboardStats();
            } catch (error) {
                console.error('Error rejecting listing:', error);
                showToast('Failed to reject listing. Please try again.', true);
            }
        }

        // Close view property modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeViewPropertyModal();
                closeImageFullscreen();
            }
        });
    </script>
</body>

</html>
